---
argument_specs:
  main:
    short_description: Common tasks role
    options:
      _common_install:
        type: dict
        required: true
        description:
          - Installation tasks (akin install(1)).
        options: &common-install-opts
          defaults:
            type: dict
            description:
              - Sets default flags for all targets that did not specify it explicitly.
            options:
              become:
                type: bool
                required: false
                default: false
                description:
                  - Whenever to use the ansible 'become' mechanism.
              wipe:
                type: bool
                required: false
                default: false
                description:
                  - Ignored when `policy.destructive` is false.
                  - For directory targets, wipe the provided directory.
                  - For file targets, wipe the parent directory.
              create:
                type: bool
                required: false
                default: true
                description:
                  - Whenever to create the target.
                  - For file targets, this creates an empty file.
              owner:
                type: str
                required: false
                default: "{{ users.user.name }}"
                description:
                  - Owner of the filesystem objects (including parent directory for file targets).
              group:
                type: str
                required: false
                default: "{{ users.user.name }}"
                description:
                  - Group of the filesystem objects (including parent directory for file targets).
              filemode:
                type: str
                required: false
                default: "0644"
                description:
                  - File targets permissions.
              dirmode:
                type: str
                required: false
                default: "0644"
                description:
                  - For directory targets, set the provided directory permissions.
                  - Fir file targets, set the parent directory permissions.
              base:
                type: str
                required: false
                default: "{{ users.user.config }}"
                description:
                  - The base path for all targets that are not absolute.
          targets:
            type: list
            description:
              - A list of targets to process.
            required: true
            elements: dict
            options:
              dir:
                type: str
                required: false
                description:
                  - An absolute or relative path to the directory target.
              file:
                type: str
                required: false
                description:
                  - An absolute or relative path to the file target.
              copy:
                type: str
                required: false
                description:
                  - A file from this playbook to copy to the file target.
              content:
                type: str
                required: false
                description:
                  - A string content to write to the file target.
              template:
                type: str
                required: false
                description:
                  - A template to render to the file target.
              link:
                type: str
                required: false
                description:
                  - The control node filesystem object to link to the target.
              wipe:
                type: bool
                required: false
                description:
                  - This setting has the same meaning as the `defaults.wipe` but on the target level.
              create:
                type: bool
                required: false
                description:
                  - This setting has the same meaning as the `defaults.create` but on the target level.
              owner:
                type: str
                required: false
                description:
                  - This setting has the same meaning as the `defaults.owner` but on the target level.
              group:
                type: str
                required: false
                description:
                  - This setting has the same meaning as the `defaults.group` but on the target level.
              filemode:
                type: str
                required: false
                description:
                  - This setting has the same meaning as the `defaults.filemode` but on the target level.
              dirmode:
                type: str
                required: false
                description:
                  - This setting has the same meaning as the `defaults.dirmode` but on the target level.
              base:
                type: str
                required: false
                description:
                  - This setting has the same meaning as the `defaults.base` but on the target level.

      _common_packages:
        type: dict
        required: false
        description:
          - Packaging tasks.
        options:
          remove:
            type: list
            elements: str
            required: false
            description:
              - List of the packages to remove.
          force:
            type: bool
            required: false
            description:
              - Whenever to forcefully install package even if it already installed.
              - Might be useful to trigger installation hooks.
          sync:
            type: bool
            required: false
            description:
              - Whenever to sync package manager database.
          upgrade:
            type: bool
            required: false
            description:
              - Whenever to upgrade packages to their last version.
          install:
            type: list
            elements: str
            required: false
            description:
              - List of the packages to install. It also supports AURs.

      _common_vm:
        type: dict
        required: false
        description:
          - Tools management via version manager.
        options:
          wipe:
            type: list
            elements: str
            required: false
            description:
              - List of the packages to wipe (including all versions).
          install:
            type: list
            elements: str
            required: false
            description:
              - List of the packages to install.

      _common_services:
        type: dict
        required: false
        description:
          - Service manager.
        options:
          defaults:
            type: list
            elements: str
            required: false
            description:
              - Sets default flags for all targets that did not specify it explicitly.
              - >-
                'user' or 'system' switches between user and system manager instances.
              - >-
                'reload' requests the service manager to reload its configuration.
                Apparently useful it case of service configuration change.
              - >-
                'start' or 'stop' sets whether service must be restarted or stopped.
              - >-
                'mask' or 'unmask' sets whether it must be impossible to load the service
                even if it is a hard dependency of other services.
                There are the following possible scenarios according to the passed value:
                 - 'mask' => implies 'start'
                 - 'unmask' => implies 'stop'
                 - nothing => defaults to 'unmask', but without implying neither 'mask' nor 'stop'.
              - >-
                'enable' or 'disable' sets whether service must be enabled or disabled at startup automatically.
                Specifying 'enable' also implies 'start', and 'disable' implies 'stop'.
            choices:
              - user
              - system
              - reload
              - mask
              - unmask
              - enable
              - disable
              - stop
              - start
          targets:
            type: dict
            description:
              - A mapping of the target to its options.

      _common_gpg:
        type: str
        required: false
        description:
          - Retrieves previously generated GnuPG key metadata.
          - If string is passed, that specific entry is retrieved.
          - If none is passed instead, the entire key metadata dictionary is returned instead.
          - The result is stored in the `_common_gpg_invocation` variable.

      _common_pull:
        type: dict
        required: false
        description:
          - Pull artifacts of different types from manage node to control node to the persist directory.
          - Persist files are located on control node in the `persist.base` directory.
          - >-
            Pulling artifacts to the persist storage always respects `persist.filemode` and `persist.dirmode`,
            as well as the owner of the `persist.base`. This way, even when ansible is running as root, it still
            creates accessible files.
        options:
          defaults:
            type: dict
            required: false
            description:
              - Sets default options for all targets that did not specify it explicitly.
            options:
              become:
                type: bool
                required: false
                default: false
                description:
                  - Whenever to use the ansible 'become' mechanism.
              base:
                type: str
                required: false
                default: "{{ users.user.config }}"
                description:
                  - The base path for all targets that are not absolute.
          targets:
            type: dict
            description:
              - A mapping of the target to its options.
              - >-
                Each key must be a relative path to the persist item, typically <class>/<item> such as
                myapp/settings, consisting any of the following items:
                 `base64` - base64 encoded string to pull.
                 `shell` - shell command that runs on manage node, whose stdout is pulled.
                 `stdin` - stdin to pass to the `shell`.
                 `file` - manage node path to the file to pull.
                 `archive` - manage node path to create archive and pull from.
                 `include` - list of patterns to include to `archive`.
                 `exclude` - list of patterns to exclude from `archive`.
                 `become`, `base` - individual overrides with the same meaning as in the `defaults`.

      _common_push:
        type: dict
        required: false
        description:
          - Push artifacts of different types from control node to manage node from the persist directory.
        options:
          defaults: *common-install-opts
          targets:
            type: dict
            description:
              - A mapping of the target to its options.
              - >-
                Each key must be a relative path to the persist item, typically <class>/<item> such as
                myapp/settings, consisting any of the following items:
                 `shell` - shell command that runs on manage node and receives content of the persist item from the stdin.
                 `file` - manage node path to the file to push the persist item to.
                 `archive` - manage node path to unpack archive to.
                 `become`, `base`, `filemode`, `dirmode`, `wipe` - individual overrides with the same meaning as in the `defaults`.

      _common_persist:
        type: str
        required: false
        description:
          - Try to query the persist item in the base64 encoding.
          - Sets variable `_common_persist_invocation`, which would have `content` element if the query was successful.

      _common_cmdline:
        type: dict
        required: false
        description:
          - Updates the kernel command-line parameters for the next boot.
          - Must be mapping, where each key denotes name of the parameter, and key its value.
          - >-
            Value may take several forms:
             - null (i.e. YAML `~` or empty) => rendered as `key`, previous keys are overwritten.
             - string => rendered as `key=value`, previous values are overwritten.
             - array => rendered as `key=value1,value2`, previous values are merged.

      _common_groups:
        type: list
        elements: str
        required: false
        description:
          - Adds the user to the specified list of groups.

      _common_environment:
        type: list
        required: false
        description:
          - Modifies global system-wide /etc/environment file with the provided key-value pairs.
        elements: dict
        options:
          key:
            type: str
            required: true
            description:
              - Key of the environmental variable.
          value:
            type: str
            required: true
            description:
              - Value of the environmental variable.

      _common_urlunpack:
        type: dict
        required: false
        description:
          - Downloads and unpacks specified archive without creating temporary files.
          - Backed up by the bsdtar (libarchive).
          - Capable of handling not only .tar archives, but also .zip, .7z, .jar, and more.
        options:
          become:
            type: bool
            required: false
            default: false
            description:
              - Whenever to use the ansible 'become' mechanism.
              - Also modifies owner and group of all unpacked files to root if `true` and `users.user.name` otherwise.
          creates:
            type: str
            required: false
            description:
              - Same as Ansible's `creates` - a path, the existence of which indicates that the operation must not be performed.
          dest:
            type: str
            required: true
            description:
              - The destination directory that is created if needed.
          exclude:
            type: list
            required: false
            elements: str
            description:
              - List of the file pattern to exclude.
          url:
            type: str
            required: true
            description:
              - The link to download archive from.
          strip:
            type: int
            required: false
            description:
              - Number specifying the number of removed leading path elements from archive.
