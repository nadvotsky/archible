---
policy:
  #
  # An unsafe flag that will ensure clearness of installation targets.
  #
  # This means it would entirely clean configuration directories (XDG_CONFIG_HOME/<package>)
  # for most of the packages, as well as other state directories (~/.local/share/<package>).
  #
  # It also removes unnecessary files for bootloader, user profile, and similar.
  #
  destructive: true

persist: "{{ playbook_dir }}/persist"

machine:
  disk_identifier: ata-SSD_256GB
  mount: /mnt

  locale: en_US.UTF-8
  keymap: us
  timezone: Europe/Berlin
  hostname: &machine-workspace hostname
  dns:
    ip: "1.1.1.1"
    sni: cloudflare-dns.com

  #
  # Refer to the roles/prelude/apart/README.md
  # for more info.
  #
  partitions:
    - name=TEST-EFI,type=efi,size=1G
    - name=TEST-ROOT,type=root,fs=xfs,size=85%
    - name=TEST-SWAP,type=swap,size=8G
    - name=TEST-VOLT,type=linux,fs=ext4

  mountopts:
    root: &machine-mountopts-root "\
      async,noatime,auto,dev,exec,noiversion,suid,rw,nouser,\
      dax=always,nodiscard,noquota\
      "
    efi: "\
      sync,noatime,auto,dev,exec,noiversion,suid,rw,nouser,\
      fmask=0023,dmask=0022,check=s,discard,errors=remount-ro,iocharset=utf8,tz=UTC,flush,utf8\
      "

  cmdline:
    #
    # kernel
    #
    iommu: "off"
    amd_iommu: "off"
    gbpages: ~
    mce: "off"
    align_va_addr: "on"
    ipv6.disable: "1"
    apparmor: "0"
    audit: "0"
    cgroup_disable: "memory"
    clocksource: "tsc"
    console_msg_format: "syslog"
    cpufreq.default_governor: "performance"
    cpuidle.governor: "teo"
    cryptomgr.notests: ~
    debugfs: "off"
    dis_ucode_ldr: ~
    driver_async_probe: "*"
    enable_mtrr_cleanup: ~
    hibernate: "no"
    hostname: *machine-workspace
    hpet_mmap: "1"
    ia32_emulation: "false"
    ima_appraise: "off"
    ima_policy: "critical_data"
    init_on_alloc: "0"
    init_on_free: "0"
    iomem: "relaxed"
    io_delay: "none"
    kmemleak: "off"
    kunit.enable: "0"
    logo.nologo: ~
    lp: "0"
    memory_corruption_check: "0"
    mitigations: "off"
    nohibernate: ~
    nosoftlockup: ~
    nowatchdog: ~
    panic: "0"
    parport: "0"
    nopti: ~
    preempt: "full"
    ras: "cec_disable"
    rootdelay: "0"
    selinux: "0"
    sysrq_always_enabled: ~
    transparent_hugepage: "always"
    lsm: "capability,yama,bpf"
    split_lock_detect: "off"
    no_timer_check: ~
    pci: "pcie_bus_perf"
    #
    # systemd related
    #
    systemd.restore_state: "0"
    quotacheck.mode: skip
    net.ifnames: "0"
    plymouth.enable: "0"
    systemd.verity: "no"
    systemd.gpt_auto: "0"
    systemd.firstboot: "off"
    #
    # Audio
    #
    module_blacklist: "snd_hda_codec_hdmi,snd_seq,asus_wmi"
    snd_hda_intel.position_fix: 6
    #
    # video
    #
    video: efifb:mode=0
    nvidia.NVreg_InitializeSystemMemoryAllocations: "0"
    nvidia.NVreg_UsePageAttributeTable: "1"
    nvidia_drm.modeset: "1"
    #
    # sysctl
    #
    sysctl.kernel.stack_erasing: "0"
    sysctl.fs.dmesg_restrict: "0"
    sysctl.net.busy_read: "50"
    sysctl.net.busy_poll: "50"
    sysctl.vm.swappiness: "30"
    sysctl.net.ipv4.tcp_fastopen: "3"
    #
    # initrd
    #
    rootfstype: "xfs"
    rootflags: *machine-mountopts-root
    rw: ~
    booster.log: "error"
    #
    # frequently used
    #
    quiet: ~
    loglevel: "4"

users:
  root:
    password: test

  user:
    name: test
    password: test

    short: Example
    full: Example User
    alt: Exemple d'Utilisateur
    email: example@.local

    groups:
      - adm
      - wheel
      - audio
      - video
      - input
      - systemd-journal
      - log
      - kvm

    home: /home/test
    config: /home/test/.config
    cache: /home/test/.cache
    share: /home/test/.local/share
    state: /home/test/.local/state
    bin: /home/test/.local/bin

    xdg_quirks:
      PYTHONPYCACHEPREFIX: $XDG_CACHE_HOME/python/pycache
      PYTHON_HISTORY: $XDG_CACHE_HOME/python/history

    xdg:
      downloads: dls
      documents: env
      pictures: media/pics
      videos: media/vids
      music: media/music
      templates: misc/templates
      publicshare: misc/public
      desktop: misc/desktop

security:
  pam:
    nodelay: true
  ssh:
    cipher:
      - aes128-gcm@openssh.com
      - aes128-cbc
      - aes128-ctr
      - aes256-gcm@openssh.com
      - aes256-cbc
      - aes256-ctr
      - chacha20-poly1305@openssh.com
    public_key:
      - ecdsa-sha2-nistp256
      - ssh-ed25519
      - ssh-ed25519-cert-v01@openssh.com
      - ecdsa-sha2-nistp256-cert-v01@openssh.com
      - rsa-sha2-512
      - rsa-sha2-512-cert-v01@openssh.com
    key_exchange:
      - ecdh-sha2-nistp256
      - curve25519-sha256
      - curve25519-sha256@libssh.org
      - sntrup761x25519-sha512@openssh.com
      - diffie-hellman-group-exchange-sha256
    message_auth:
      - umac-64-etm@openssh.com
      - umac-128-etm@openssh.com
      - hmac-sha2-512-etm@openssh.com
      - hmac-sha2-256-etm@openssh.com
      - hmac-sha2-512
      - hmac-sha2-256
  gpg:
    keyserver: hkps://keys.openpgp.org
    metadata: unattended-keys.json
    hash:
      - SHA512
      - SHA384
      - SHA256
      - SHA224
    cipher:
      - AES
      - AES-192
      - AES-256
      - CAMELLIA128
      - CAMELLIA192
      - CAMELLIA256
      - CAST5
      - IDEA
    compression:
      - Uncompressed
      - ZIP
      - ZLIB

gpg:
  private:
    master:
      name: "{{ users.user.name }}"
      comment: private usage only
      email: "{{ users.user.name }}@invalid."

      expire: 5y
      password: test

      algo: ecdsa
      hint: nistp256
    subkeys:
      private_encr_main:
        type: encr
        algo: ecdh
        hint: nistp256
      private_encr_passwords:
        type: encr
        algo: ecdh
        hint: nistp256
      private_encr_backups:
        type: encr
        algo: ecdh
        hint: nistp256
      private_ssh:
        type: auth
        priority: 100
        algo: ecdsa
        hint: nistp256
  compat:
    master:
      name: "{{ users.user.full }}"
      comment: "{{ users.user.alt }}; compat algorithms"
      email: "{{ users.user.email }}"

      expire: 5y
      password: test

      algo: rsa
      hint: 3072
    subkeys:
      compat_sign_main:
        type: sign
        algo: dsa
        hint: 2048
      compat_sign_alt:
        type: sign
        algo: rsa
        hint: 3072
      compat_encr:
        type: encr
        algo: rsa
        hint: 3072
      compat_ssh:
        type: auth
        priority: 500
        algo: rsa
        hint: 3072
  primary:
    master:
      name: "{{ users.user.full }}"
      comment: "{{ users.user.alt }}"
      email: "{{ users.user.email }}"

      expire: 5y
      password: test

      algo: ecdsa
      hint: nistp256
    subkeys:
      primary_sign:
        type: sign
        algo: ecdsa
        hint: nistp256
      primary_encr:
        type: encr
        algo: ecdh
        hint: nistp256
      primary_ssh_main:
        type: auth
        priority: -100
        algo: ecdsa
        hint: nistp256
      primary_ssh_alt:
        type: auth
        priority: -500
        algo: ed25519
        hint: ~

media:
  features:
    #
    # Whenever enable save feature for volumes and "fallback" source and sink.
    #
    save: false
    #
    # Video capture support.
    #
    video_v4l2: false
    video_libcamera: false
    #
    # Midi support.
    #
    midi: false
    #
    # Jack support.
    #
    jack: false
    #
    # Bluez5 support.
    #
    bluetooth: false
    #
    # Noise suppression device.
    #
    rnnoise: true
    #
    # Loopback device that basically acts as a virtual output
    #  particulary useful to omit some of the applications from recordings.
    #
    loopback: true
  quantum:
    min: 256
    default: 1024
    max: 4096
  realtime:
    nice: -10
    priority: 80
  #
  # VAD Threshold.
  #
  rnnoise_threshold: 50.0
  #
  # Percentage of complexity
  #
  resampling: 0.5
  volume:
    output: 0.68 # -10db
    input: 0.56 # -25 db
  #
  # List of the apps that have full access to the mixers.
  #  Extremely useful in case of WebRTC automatic gain control.
  #
  whitelist:
    - pavucontrol
    - helvum
    - waybar
    - wpctl
  cards:
    main:
      selectors:
        device:
          device.form-factor: internal
        input:
          api.alsa.card.name: HDA ATI SB
          api.alsa.pcm.stream: capture
        output:
          api.alsa.card.name: HDA ATI SB
          api.alsa.pcm.stream: playback
      #
      # Create a rule that would disable any other devices other than this.
      #
      exclusive: true
      #
      # Must be of 48000 when `virtual.rnnoise` is enabled.
      #
      frequency: 48000
      format: S32LE
      channels: [FL, FR]
      inputs:
        jacks:
          Rear Mic:
          Line:
          Front Mic:
        enumerations:
          Loopback Mixing:
          Input Source:
        #
        # Some capture mixers are bugged and marked for playback.
        #
        elements:
          Capture,0:
            type: [switch, volume]
          Capture,1:
            type: [switch, volume]
          Rear Mic:
            type: [switch, volume]
            direction: playback
          Rear Mic Boost:
            type: [volume]
          Line:
            type: [switch, volume]
            direction: playback
          Line Boost:
            type: [volume]
            direction: playback
          Front Mic:
            type: [switch, volume]
            direction: playback
          Front Mic Boost:
            type: [volume]
      outputs:
        jacks:
          Line Out Front:
          Line Out Surround:
          Line Out CLFE:
          Line Out Side:
          Front Headphone:
          SPDIF Phantom:
        enumerations:
          Auto-Mute Mode:
        elements:
          Front:
            type: [switch, volume]
          PCM:
            type: [volume]
          Master:
            type: [switch, volume]
          Headphone:
            type: [switch, volume]
          Surround:
            type: [switch, volume]
          Center:
            type: [switch, volume]
          LFE:
            type: [switch, volume]
          Side:
            type: [switch, volume]
          IEC958:
            type: [switch]
          IEC958 Default PCM:
            type: [switch]
      acp:
        output:analog-stereo-headset+input:analog-stereo-headset:
          type: profile
          inputs:
            - analog-stereo-headset
          outputs:
            - analog-stereo-headset
        analog-stereo-headset:
          type: mapping
          label: analog-stereo-headset
          device: front:%f
          priority: 10
          inputs:
            - analog-input-microphone-headset
          outputs:
            - analog-output-headphones
        analog-input-microphone-headset:
          type: input-path
          label: analog-input-microphone-headset
          priority: 10
          jacks:
            Rear Mic:
          elements:
            Capture,0:
            Rear Mic:
            Rear Mic Boost:
          enumerations:
            Input Source:
              option: Rear Mic
              description: input-microphone
            Loopback Mixing:
              option: Disabled
              description: input
        analog-output-headphones:
          type: output-path
          label: analog-output-headphones
          priority: 10
          jacks:
            Line Out Front:
          elements:
            Front:
            PCM:
            Master:
          enumerations:
            Auto-Mute Mode:
              option: Disabled
              description: output-headphones

icons:
  main:
    name: Zorin
    package: zorin-icon-themes

  launcher:
    name: Nordzy
    package: nordzy-icon-theme

fonts:
  sizes: &fonts-sizes
    small: 11
    medium: 13
    big: 16
  offsets: &fonts-offsets
    small: 1
    medium: 2
    big: 3

  monospace:
    name: Source Code Pro
    package: adobe-source-code-pro-fonts
    sizes: *fonts-sizes
    offsets: *fonts-offsets
  serif:
    name: Inter
    package: inter-font
    sizes: *fonts-sizes
    offsets: *fonts-offsets
  sans_serif:
    name: Inter
    package: inter-font
    sizes: *fonts-sizes
    offsets: *fonts-offsets
  emoji:
    name: JoyPixels
    package: ttf-joypixels
    sizes: *fonts-sizes
    offsets: *fonts-offsets
  icon:
    name: Symbols Nerd Font Mono
    package: ttf-nerd-fonts-symbols-mono
    sizes:
      small: 13
      medium: 15
      big: 18
    offsets:
      small: 2
      medium: 2
      big: 3

inputs:
  mask:
    keyboard-subdevice: "SEM USB Keyboard Consumer Control"
    power-button: "Power Button"
    fake-keyboard: "USB OPTICAL MOUSE  Keyboard"

  mouse:
    accel: flat
    speed: -0.5

  keyboard:
    model: pc104
    layout: us,ru,ua
    options: grp:menu_toggle,compose:rctrl,terminate:ctrl_alt_bksp

gui:
  gtk:
    name: Arc-Dark-solid
    package: arc-solid-gtk-theme

  kvantum:
    name: ArcDark
    package: kvantum-theme-arc

monitors:
  stack: horizontal
  outputs:
    primary:
      workspaces: 8
      width: 1920
      height: 1080
      refresh: 60
      x11: DFP-1
      wayland: HDMI-A-1

    secondary:
      workspaces: 4
      width: 1280
      height: 1024
      refresh: 75
      x11: DFP-5
      wayland: HDMI-A-3

scaling:
  #
  # Assuming that virtual perfect monitor has the following DPI.
  # All spacings are based on this value.
  #
  ethalon: 96
  #
  # Real monitor is different.
  #
  # Dpi is a very tricky metric, because it is up to the application
  # how to implement scaling. For example:
  #   herbstluftwm
  #     scales font,
  #     does not scale paddings, offsets, etc.
  #   polybar
  #     scales spaces, points, both :size and :pixelsize,
  #     does not scale pixels and font offsets.
  #   dunst
  #     scales sizes, spacings, and font when dpi is greater than 96,
  #     but only (down)scales font when dpi is smaller than 96
  #   and so on.
  #
  #   While it is okay for the regular user applications to be scaled arbitrary,
  #   it is not the case for the WM & related programs.
  #
  #   For instance, when herbstluftwm draws a 5 pixels border around window,
  #   it is quite noticable when rofi draws about 7 pixels.
  #   Another example is that changing dpi for polybar will not affect other
  #   programs, as well as will break polybar itself, because font offset
  #   is not affected by the DPI.
  #
  #   Practically it means that it is impossible to create a dpi-aware stack
  #   of the window manager environment. Therefore, using its own dpi-like mechanism,
  #   where elements are being scaled at the template rendering stage.
  #
  real: 0.9

spacing:
  thin: 1
  small: 2
  medium: 6
  big: 11

notifications:
  monitor: secondary
  height: 0.3
  width: 0.6
  icon: 0.1

execs:
  uptime: uptime -p | sed -E 's/up //; s/ days?,?/d/; s/ hours?,?/h/; s/ minutes?,?/m/'
  netns: (ip netns list | grep -q .) && (ip netns list | tr '\\n' ' ')

wms:
  scratch: Scratch

theme:
  dark1: &dark1 "#2e3440"
  dark2: &dark2 "#3b4252"
  dark3: &dark3 "#434c5e"
  dark4: &dark4 "#4c566a"

  snow1: &snow1 "#d8dee9"
  snow2: &snow2 "#e5e9f0"
  snow3: &snow3 "#eceff4"

  cyan1: &cyan1 "#8fbcbb"
  cyan2: &cyan2 "#88c0d0"

  blue1: &blue1 "#81a1c1"
  blue2: &blue2 "#5e81ac"

  red: &red "#bf616a"
  orange: &orange "#d08770"

  yellow: &yellow "#ebcb8b"
  green: &green "#a3be8c"

  purple: &purple "#b48ead"

ansi:
  normal:
    # black red green yellow blue magenta cyan white
    - *dark2
    - *red
    - *green
    - *orange
    - *blue2
    - *purple
    - *cyan1
    - *snow1
  bright:
    # black red green yellow blue magenta cyan white
    - *dark4
    - *red
    - *green
    - *yellow
    - *blue1
    - *purple
    - *cyan2
    - *snow3

preset:
  accent: *blue1
  alternative: *cyan1

  emphasis: *blue2
  complement: *cyan2

  sharp: *snow3
  foreground: *snow1
  background: *dark3

  important: *purple
  unimportant: *dark4

  active: *dark4
  inactive: *dark2

  border: *dark1

  positive: *green
  neutral: *yellow
  negative: *red

keys:
  modifiers:
    wm:
      main: SUPER
      alt: SUPER+SHIFT
    emacs:
      main: ALT
      alt: ALT+SHIFT
    common:
      main: CTRL
      alt: CTRL+SHIFT
    term:
      main: CTRL+ALT
      alt: CTRL+ALT+SHIFT
    vim:
      main: ~
      alt: SHIFT
    bare:
      main: ~
      alt: SHIFT
    extra:
      word: ALT
      many: CTRL
      select: SHIFT

  binds:
    escape:
      - :bare Escape
    close:
      - :common w
      - :wm q
    kill:
      - :common :alt w
      - :wm :alt q
    quit:
      - :common q
      - :wm :alt Backspace
    terminate:
      - :common :alt q

    cycle_next:
      - :bare Tab
    cycle_prev:
      - :bare BackTab

    goto:
      - :common g

    open:
      - :common o
    invoke:
      - :common i
    clear_all:
      - :term l
      - :common l
    save:
      - :common s
    external:
      - :term p
      - :common p
    prompt:
      - :vim :alt ;
      - :common e

    enter:
      - :bare Enter
    space:
      - :bare Space
    delete:
      - :vim d
      - :bare Backspace
    delete_forward:
      - :bare Delete
      - :common h

    switch_case:
      - :vim c
    search_selection:
      - :vim s
    files:
      - :vim f

    insert_mode:
      - :vim i
    select_mode:
      - :vim v

    select_all:
      - :common a
    select_swap:
      - :vim o

    undo:
      - :vim u
      - :common z
    redo:
      - :vim :alt u
      - :common :alt z
      - :common y
      - :common r
    copy:
      - :vim y
      - :common c
      - :term c
    paste:
      - :common v
      - :vim p
      - :wm v
    cut:
      - :wm x
      - :common x

    left:
      - :vim h
      - :bare Left
      - :wm h
      - :wm Left
    up:
      - :vim k
      - :bare Up
      - :wm k
      - :wm Up
    right:
      - :vim l
      - :bare Right
      - :wm l
      - :wm Right
    down:
      - :vim j
      - :bare Down
      - :wm j
      - :wm Down

    line_up:
      - :emacs Up
    line_down:
      - :emacs Down

    line_begin:
      - :vim 0
      - :emacs a
    line_begin_alt:
      - :emacs :alt a
    line_end:
      - :vim :alt 4
      - :emacs e
    line_end_alt:
      - :emacs :alt e
    line_delete:
      - :emacs d
    line_clear:
      - :emacs k
      - :vim :alt d

    word_next:
      - :vim w
    word_prev:
      - :vim b
    word_delete:
      - :emacs w

    pageup:
      - :vim u
      - :bare PageUp
    pagedown:
      - :vim d
      - :bare PageDown
    pageup_half:
      - :vim :alt u
    pagedown_half:
      - :vim :alt d

    file_begin:
      - :vim g
      - :emacs ,
    file_end:
      - :vim :alt g
      - :emacs .

    search:
      - :term f
      - :common f
    search_next:
      - :vim n
      - :bare F3
    search_prev:
      - :vim :alt n
      - :bare :alt F3

    output_next:
      - :wm Escape
    output_prev:
      - :wm :alt Escape

    workspace_next:
      - :wm Tilde
    workspace_prev:
      - :wm :alt Tilde
    workspaces:
      - :wm F5
      - :wm F6
      - :wm F7
      - :wm F8
      - :wm F1
      - :wm F2
      - :wm F3
      - :wm F4
      - :wm F9
      - :wm F10
      - :wm F11
      - :wm F12
    workspaces_move:
      - :wm :alt F5
      - :wm :alt F6
      - :wm :alt F7
      - :wm :alt F8
      - :wm :alt F1
      - :wm :alt F2
      - :wm :alt F3
      - :wm :alt F4
      - :wm :alt F9
      - :wm :alt F10
      - :wm :alt F11
      - :wm :alt F12

    group_next:
      - :wm Tab
    group_prev:
      - :wm :alt Tab

    tab_next:
      - :common Tab
      - :wm CapsLock
      - :wm MouseNext
    tab_prev:
      - :common :alt BackTab
      - :wm :alt CapsLock
      - :wm MousePrev
    tabs:
      - :wm 1
      - :wm 2
      - :wm 3
      - :wm 4
      - :wm 5

    terminal:
      - :wm w
    terminal_topmost:
      - :wm :alt w
    run:
      - :wm e
    windows:
      - :vim w
      - :wm :alt e
    scratch:
      - :wm r

    netns:
      - :wm y
    screenshot_clipboard:
      - :wm o
    screenshot_file:
      - :wm :alt o

    focus_urgent:
      - :wm u
    notifications:
      - :wm :alt u
    tiling:
      - :wm p

    fullscreen:
      - :wm a
    layout:
      - :wm s
    layout_alt:
      - :wm :alt s
    floating:
      - :wm d
    group:
      - :wm f
    layout_group:
      - :wm :alt f

    layout_master:
      - :wm z
    split_v:
      - :wm c
    split_h:
      - :wm n
    layout_v:
      - :wm :alt c
    layout_h:
      - :wm :alt n

    minimize:
      - :wm m
    focus_minimized:
      - :wm :alt m

    audio_play:
      - :bare XF86AudioPlay
    audio_stop:
      - :bare XF86AudioStop
    audio_prev:
      - :bare XF86AudioPrev
    audio_next:
      - :bare XF86AudioNext

    move:
      - :wm MouseLeft
    zoom:
      - :wm MouseMiddle
    resize:
      - :wm MouseRight
