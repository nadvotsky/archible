{%- set _acc = lookup("ansible.builtin.template", "local_templates/conan_targets.j2") -%}
{%- for _name, _build in __cplusplus.builds.items() -%}
    {%- if _build.default is true -%}
        {%- continue -%}
    {%- endif -%}

    {%- set _lines = [] -%}
    {%- for _section in {
        "built-in options": _build.meson.options,
        "binaries": _build.meson.binaries,
    } | dict2items | selectattr("value", "defined") -%}
        {%- do _lines.append("[{}]".format(_section.key)) -%}
        {%- for _prop, _val in _section.value.items() -%}
            {%- do _lines.append(
                "{} = {}".format(
                    _prop, (_val | string | squote) if _val is string else (_val | string | lower),
                ),
            ) -%}
        {%- endfor -%}
        {%- do _lines.append("\n") -%}
    {%- endfor -%}

    {%- if _lines | length > 0 -%}
        {%- do _acc.append({
            "file": "config/natives/{}.ini".format(_name),
            "content": _lines | join("\n"),
        }) -%}
    {%- endif -%}
{%- endfor -%}

{{ _acc }}
